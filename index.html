<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRO STORE 2.0</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, "Sarabun", sans-serif;
  background:#0f172a;
  color:white;
}
.center{display:flex;justify-content:center;align-items:center;height:100vh}
.box{background:#1e293b;padding:30px;border-radius:15px;width:320px}
input{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  border:none;
  font-size:16px;
}
button{
  padding:12px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  width:100%;
  font-size:15px;
}
.main{background:#22c55e;color:black}
nav{display:flex;gap:10px;padding:15px;background:#111827}
.section{display:none;padding:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px}
.card{background:#1e293b;padding:15px;border-radius:15px;text-align:center}
.card img{width:100%;height:150px;object-fit:cover;border-radius:10px}
</style>
</head>
<body>

<div id="auth" class="center">
  <div class="box">
    <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <input id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ö‡∏≠‡∏£‡πå">
    <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
    <button class="main" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <button onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    <p id="authMsg"></p>
  </div>
</div>

<div id="app" style="display:none;">
  <nav id="navbar"></nav>
  <div id="shop" class="section"></div>
  <div id="orders" class="section"></div>
  <div id="admin" class="section"></div>
</div>

<script>
const supabase = window.supabase.createClient(
"https://fmykgxcnrbzjcwsezthk.supabase.co",
"sb_publishable_AwAtOhcZiPWiz-VQuKPjWQ_XGvll29G"
)

const specialPhone="0637695934"
const specialPass="1669"
const adminEmail="oil166922@gmail.com"

let user=null
let isSpecialAdmin=false

async function login(){
  const email=document.getElementById("email").value.trim()
  const password=document.getElementById("password").value.trim()

  // üî• ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏û‡∏¥‡πÄ‡∏®‡∏©
  if(email===specialPhone && password===specialPass){
    user={ email:"admin@phone.local" }
    isSpecialAdmin=true
    startApp()
    return
  }

  // üîπ ‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ä‡πâ Supabase
  const { data, error } = await supabase.auth.signInWithPassword({email,password})

  if(error){
    document.getElementById("authMsg").innerText=error.message
    return
  }

  user=data.user
  startApp()
}

async function register(){
  const email=document.getElementById("email").value.trim()
  const password=document.getElementById("password").value.trim()

  const { error } = await supabase.auth.signUp({email,password})

  if(error){
    document.getElementById("authMsg").innerText=error.message
  }else{
    document.getElementById("authMsg").innerText="‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô"
  }
}

function startApp(){
  document.getElementById("auth").style.display="none"
  document.getElementById("app").style.display="block"

  buildNav()
  show("shop")
  loadProducts()
  loadOrders()
}

function buildNav(){
  const nav=document.getElementById("navbar")
  nav.innerHTML=`
    <button onclick="show('shop')">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <button onclick="show('orders')">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
    ${(user.email===adminEmail || isSpecialAdmin)?'<button onclick="show(\'admin\')">‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>':''}
    <button onclick="logout()">‡∏≠‡∏≠‡∏Å</button>
  `
}

function show(sec){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none")
  document.getElementById(sec).style.display="block"
}

async function loadProducts(){
  const { data } = await supabase.from("products").select("*")
  const shop=document.getElementById("shop")
  shop.innerHTML="<h2>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2><div class='grid'></div>"
  const grid=shop.querySelector(".grid")

  data?.forEach(p=>{
    grid.innerHTML+=`
    <div class="card">
      <img src="${p.image||'https://via.placeholder.com/300'}">
      <h4>${p.name}</h4>
      <div>${p.price} ‡∏ö‡∏≤‡∏ó</div>
      <button onclick="order('${p.name}',${p.price})">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
    </div>`
  })
}

async function order(name,price){
  await supabase.from("orders").insert([{
    user_email:user.email,
    product_name:name,
    price:price
  }])
  alert("‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
  loadOrders()
}

async function loadOrders(){
  const { data } = await supabase.from("orders").select("*")
  const orders=document.getElementById("orders")
  orders.innerHTML="<h2>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>"

  data?.forEach(o=>{
    if(user.email===adminEmail || isSpecialAdmin || o.user_email===user.email){
      orders.innerHTML+=`
      <div class="card">
        <div>${o.product_name}</div>
        <div>${o.price} ‡∏ö‡∏≤‡∏ó</div>
        <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${o.status}</div>
      </div>`
    }
  })

  if(user.email===adminEmail || isSpecialAdmin){
    buildAdmin()
  }
}

function buildAdmin(){
  const admin=document.getElementById("admin")
  admin.innerHTML=`
    <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
    <input id="pname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)">
    <input id="pprice" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
    <input id="pimage" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">
    <button onclick="addProduct()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
  `
}

async function addProduct(){
  const name=document.getElementById("pname").value
  const price=document.getElementById("pprice").value
  const image=document.getElementById("pimage").value

  await supabase.from("products").insert([{name,price,image}])
  alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")
  loadProducts()
}

function logout(){
  location.reload()
}
</script>
</body>
</html>
